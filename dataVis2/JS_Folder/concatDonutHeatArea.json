{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "background": "#FFBF61", 
  "data": {
    "url": "https://raw.githubusercontent.com/archnj/FIT3179/main/dataVis2/data_folder/Aus_Agricultural_Commodities.csv"
  },
  "transform": [
    {"filter": "datum['Value ($m)'] != null && datum['Value ($m)'] != 0"}
  ],
  "params": [
    {
      "name": "year_selection",
      "value": 2022,
      "bind": {
        "input": "range",
        "min": 2012,
        "max": 2022,
        "step": 1,
        "name": "Year: "
      }
    },
    {
      "name": "state_selection",
      "value": null,
      "bind": {
        "input": "select",
        "options": [null, "New South Wales", "Victoria", "Queensland", "South Australia", "Western Australia", "Tasmania", "Northern Territory", "Australian Capital Territory"],
        "labels": ["All", "New South Wales", "Victoria", "Queensland", "South Australia", "Western Australia", "Tasmania", "Northern Territory", "Australian Capital Territory"], 
        "name": "Select State: "
      }
    },
    {
      "name": "type_selection",
      "value": "Crops",
      "bind": {
        "input": "select",
        "options": ["Crops", "Livestock"],
        "labels": ["Crops", "Livestock"], 
        "name": "Type: "
      }
    }
  ],
  "vconcat": [
    {
      "title": "Cumulative Donut Chart",
      "width": 500,
      "height": 500,
      "transform": [
        {"filter": "datum.Type == type_selection"},
        {"filter": "datum.Year >= 2010 && datum.Year <= year_selection"},
        {"filter": "state_selection == null || datum.State == state_selection"},
        {
          "aggregate": [{
            "op": "sum",
            "field": "Value ($m)",
            "as": "Commodity Value ($m)"
          }],
          "groupby": ["Commodity"]
        },
        {"filter": "datum['Commodity Value ($m)'] > 0"}
      ],
      "mark": {"type": "arc", "innerRadius": 50},
      "encoding": {
        "theta": {"field": "Commodity Value ($m)", "type": "quantitative", "stack": true},
        "color": {
          "field": "Commodity",
          "type": "nominal",
          "scale": {"scheme": "category10"}
        },
        "tooltip": [
          {"field": "Commodity", "type": "nominal"},
          {"field": "Commodity Value ($m)", "type": "quantitative", "format": ",.0f", "title": "Cumulative Value ($m)"}
        ]
      }
    },
    {
      "title": "Heatmap",
      "width": 500,
      "height": 500,
      "transform": [
        {"filter": "datum.Type == type_selection"},
        {"filter": "state_selection == null || datum.State == state_selection"},
        {"filter": "datum.Year <= year_selection"},
        {
          "aggregate": [{
            "op": "sum",
            "field": "Value ($m)",
            "as": "Commodity Value ($m)"
          }],
          "groupby": ["Year", "Commodity"]
        },
        {"filter": "datum['Commodity Value ($m)'] > 0"}
      ],
      "mark": "rect",
      "encoding": {
        "x": {"field": "Year", "type": "ordinal"},
        "y": {"field": "Commodity", "type": "nominal"},
        "color": {
          "field": "Commodity Value ($m)",
          "type": "quantitative",
          "scale": {"scheme": "blues"}
        },
        "tooltip": [
          {"field": "Year", "type": "ordinal"},
          {"field": "Commodity", "type": "nominal"},
          {"field": "Commodity Value ($m)", "type": "quantitative", "format": ",.0f"}
        ]
      }
    },
    {
      "title": "Area Chart",
      "width": 500,
      "height": 500,
      "transform": [
        {"filter": "datum.Type == type_selection"},
        {"filter": "state_selection == null || datum.State == state_selection"},
        {"filter": "datum.Year <= year_selection"},
        {
          "aggregate": [{
            "op": "sum",
            "field": "Value ($m)",
            "as": "Commodity Value ($m)"
          }],
          "groupby": ["Year", "Commodity"]
        },
        {"filter": "datum['Commodity Value ($m)'] > 0"}
      ],
      "layer": [
        {
          "mark": "area",
          "encoding": {
            "x": {
              "field": "Year", 
              "type": "ordinal"
            },
            "y": {
              "field": "Commodity Value ($m)",
              "type": "quantitative",
              "stack": true,
              "axis": { "title": "Value ($m)" }
            },
            "color": {
              "field": "Commodity", 
              "type": "nominal",
              "scale": {"scheme": "category10"}
            },
            "tooltip": [
              {"field": "Year", "type": "ordinal"},
              {"field": "Commodity", "type": "nominal"},
              {"field": "Commodity Value ($m)", "type": "quantitative", "format": ",.0f"}
            ]
          }
        },
        {
          "mark": {
            "type": "text",
            "align": "left",
            "baseline": "middle",
            "dx": 5,
            "dy": -10,
            "fontSize": 11,
            "fontStyle": "italic"
          },
          "encoding": {
            "x": {"datum": "2020"},
            "y": {"value": 0},
            "text": {"value": "COVID-19 Pandemic"}
          }
        },
        {
          "mark": "rule",
          "encoding": {
            "x": {"datum": "2020"},
            "color": {"value": "red"},
            "size": {"value": 1}
          }
        }
      ]
    }
  ]
}